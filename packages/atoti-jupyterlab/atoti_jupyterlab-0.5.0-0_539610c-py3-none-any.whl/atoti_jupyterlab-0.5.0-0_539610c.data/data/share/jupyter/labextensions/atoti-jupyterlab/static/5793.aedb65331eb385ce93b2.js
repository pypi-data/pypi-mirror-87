(self.webpackChunkatoti_jupyterlab=self.webpackChunkatoti_jupyterlab||[]).push([[5793],{36212:(t,e,a)=>{"use strict";var o=a(20992),i=a(5227).Y,r=a(95980),n=a(73925),l=a(31025).f,s=a(31025).s,c=a(61782).extendFlat,p=r({editType:"plot",arrayOk:!0,colorEditType:"plot",description:"Sets the font used for `textinfo`."});t.exports={labels:{valType:"data_array",editType:"calc",description:["Sets the sector labels.","If `labels` entries are duplicated, we sum associated `values`","or simply count occurrences if `values` is not provided.","For other array attributes (including color) we use the first","non-empty entry among all occurrences of the label."].join(" ")},label0:{valType:"number",role:"info",dflt:0,editType:"calc",description:["Alternate to `labels`.","Builds a numeric set of labels.","Use with `dlabel`","where `label0` is the starting label and `dlabel` the step."].join(" ")},dlabel:{valType:"number",role:"info",dflt:1,editType:"calc",description:"Sets the label step. See `label0` for more info."},values:{valType:"data_array",editType:"calc",description:["Sets the values of the sectors.","If omitted, we count occurrences of each label."].join(" ")},marker:{colors:{valType:"data_array",editType:"calc",description:["Sets the color of each sector.","If not specified, the default trace color set is used","to pick the sector colors."].join(" ")},line:{color:{valType:"color",role:"style",dflt:n.defaultLine,arrayOk:!0,editType:"style",description:["Sets the color of the line enclosing each sector."].join(" ")},width:{valType:"number",role:"style",min:0,dflt:0,arrayOk:!0,editType:"style",description:["Sets the width (in px) of the line enclosing each sector."].join(" ")},editType:"calc"},editType:"calc"},text:{valType:"data_array",editType:"plot",description:["Sets text elements associated with each sector.","If trace `textinfo` contains a *text* flag, these elements will be seen","on the chart.","If trace `hoverinfo` contains a *text* flag and *hovertext* is not set,","these elements will be seen in the hover labels."].join(" ")},hovertext:{valType:"string",role:"info",dflt:"",arrayOk:!0,editType:"style",description:["Sets hover text elements associated with each sector.","If a single string, the same string appears for","all data points.","If an array of string, the items are mapped in order of","this trace's sectors.","To be seen, trace `hoverinfo` must contain a *text* flag."].join(" ")},scalegroup:{valType:"string",role:"info",dflt:"",editType:"calc",description:["If there are multiple pie charts that should be sized according to","their totals, link them by providing a non-empty group id here","shared by every trace in the same group."].join(" ")},textinfo:{valType:"flaglist",role:"info",flags:["label","text","value","percent"],extras:["none"],editType:"calc",description:["Determines which trace information appear on the graph."].join(" ")},hoverinfo:c({},o.hoverinfo,{flags:["label","text","value","percent","name"]}),hovertemplate:l({},{keys:["label","color","value","percent","text"]}),texttemplate:s({editType:"plot"},{keys:["label","color","value","percent","text"]}),textposition:{valType:"enumerated",role:"info",values:["inside","outside","auto","none"],dflt:"auto",arrayOk:!0,editType:"plot",description:["Specifies the location of the `textinfo`."].join(" ")},textfont:c({},p,{description:"Sets the font used for `textinfo`."}),insidetextorientation:{valType:"enumerated",role:"info",values:["horizontal","radial","tangential","auto"],dflt:"auto",editType:"plot",description:["Controls the orientation of the text inside chart sectors.","When set to *auto*, text may be oriented in any direction in order","to be as big as possible in the middle of a sector.","The *horizontal* option orients text to be parallel with the bottom","of the chart, and may make text smaller in order to achieve that goal.","The *radial* option orients text along the radius of the sector.","The *tangential* option orients text perpendicular to the radius of the sector."].join(" ")},insidetextfont:c({},p,{description:"Sets the font used for `textinfo` lying inside the sector."}),outsidetextfont:c({},p,{description:"Sets the font used for `textinfo` lying outside the sector."}),automargin:{valType:"boolean",dflt:!1,role:"info",editType:"plot",description:["Determines whether outside text labels can push the margins."].join(" ")},title:{text:{valType:"string",dflt:"",role:"info",editType:"plot",description:["Sets the title of the chart.","If it is empty, no title is displayed.","Note that before the existence of `title.text`, the title's","contents used to be defined as the `title` attribute itself.","This behavior has been deprecated."].join(" ")},font:c({},p,{description:["Sets the font used for `title`.","Note that the title's font used to be set","by the now deprecated `titlefont` attribute."].join(" ")}),position:{valType:"enumerated",values:["top left","top center","top right","middle center","bottom left","bottom center","bottom right"],role:"info",editType:"plot",description:["Specifies the location of the `title`.","Note that the title's position used to be set","by the now deprecated `titleposition` attribute."].join(" ")},editType:"plot"},domain:i({name:"pie",trace:!0,editType:"calc"}),hole:{valType:"number",role:"style",min:0,max:1,dflt:0,editType:"calc",description:["Sets the fraction of the radius to cut out of the pie.","Use this to make a donut chart."].join(" ")},sort:{valType:"boolean",role:"style",dflt:!0,editType:"calc",description:["Determines whether or not the sectors are reordered","from largest to smallest."].join(" ")},direction:{valType:"enumerated",values:["clockwise","counterclockwise"],role:"style",dflt:"counterclockwise",editType:"calc",description:["Specifies the direction at which succeeding sectors follow","one another."].join(" ")},rotation:{valType:"number",role:"style",min:-360,max:360,dflt:0,editType:"calc",description:["Instead of the first slice starting at 12 o'clock,","rotate to some other angle."].join(" ")},pull:{valType:"number",role:"style",min:0,max:1,dflt:0,arrayOk:!0,editType:"calc",description:["Sets the fraction of larger radius to pull the sectors","out from the center. This can be a constant","to pull all slices apart from each other equally","or an array to highlight one or more slices."].join(" ")},_deprecated:{title:{valType:"string",dflt:"",role:"info",editType:"calc",description:["Deprecated in favor of `title.text`.","Note that value of `title` is no longer a simple","*string* but a set of sub-attributes."].join(" ")},titlefont:c({},p,{description:"Deprecated in favor of `title.font`."}),titleposition:{valType:"enumerated",values:["top left","top center","top right","middle center","bottom left","bottom center","bottom right"],role:"info",editType:"calc",description:"Deprecated in favor of `title.position`."}}}},40419:(t,e,a)=>{"use strict";var o=a(85472),i=a(98621),r=a(92665),n={};function l(t){return function(e,a){return!!e&&!!(e=i(e)).isValid()&&(e=r.addOpacity(e,e.getAlpha()),t[a]||(t[a]=e),e)}}function s(t,e){var a,o=JSON.stringify(t),r=e[o];if(!r){for(r=t.slice(),a=0;a<t.length;a++)r.push(i(t[a]).lighten(20).toHexString());for(a=0;a<t.length;a++)r.push(i(t[a]).darken(20).toHexString());e[o]=r}return r}t.exports={calc:function(t,e){var a,i,r=[],n=t._fullLayout,s=n.hiddenlabels||[],c=e.labels,p=e.marker.colors||[],d=e.values,f=e._length,h=e._hasValues&&f;if(e.dlabel)for(c=new Array(f),a=0;a<f;a++)c[a]=String(e.label0+a*e.dlabel);var u={},x=l(n["_"+e.type+"colormap"]),v=0,m=!1;for(a=0;a<f;a++){var y,g,b;if(h){if(y=d[a],!o(y))continue;if((y=+y)<0)continue}else y=1;void 0!==(g=c[a])&&""!==g||(g=a);var T=u[g=String(g)];void 0===T?(u[g]=r.length,(b=-1!==s.indexOf(g))||(v+=y),r.push({v:y,label:g,color:x(p[a],g),i:a,pts:[a],hidden:b})):(m=!0,(i=r[T]).v+=y,i.pts.push(a),i.hidden||(v+=y),!1===i.color&&p[a]&&(i.color=x(p[a],g)))}return("funnelarea"===e.type?m:e.sort)&&r.sort((function(t,e){return e.v-t.v})),r[0]&&(r[0].vTotal=v),r},crossTraceCalc:function(t,e){var a=(e||{}).type;a||(a="pie");var o=t._fullLayout,i=t.calcdata,r=o[a+"colorway"],l=o["_"+a+"colormap"];o["extend"+a+"colors"]&&(r=s(r,n));for(var c=0,p=0;p<i.length;p++){var d=i[p];if(d[0].trace.type===a)for(var f=0;f<d.length;f++){var h=d[f];!1===h.color&&(l[h.label]?h.color=l[h.label]:(l[h.label]=h.color=r[c%r.length],c++))}}},makePullColorFn:l,generateExtendedColors:s}},4315:(t,e,a)=>{"use strict";var o=a(17273).appendArrayMultiPointValues;t.exports=function(t,e){var a={curveNumber:e.index,pointNumbers:t.pts,data:e._input,fullData:e,label:t.label,color:t.color,value:t.v,percent:t.percent,text:t.text,v:t.v};return 1===t.pts.length&&(a.pointNumber=a.i=t.pts[0]),o(a,e,t.pts),"funnelarea"===e.type&&(delete a.v,delete a.i),a}},53068:(t,e,a)=>{"use strict";var o=a(42895),i=a(49701),r=a(58253),n=a(92665),l=a(14124),s=a(95754),c=a(73071),p=a(37299),d=p.recordMinTextSize,f=p.clearMinTextSize,h=a(17759).TEXTPAD,u=a(75204),x=a(4315),v=a(95754).isValidTextValue;function m(t,e,a){var i=a[0],n=i.trace,l=i.cx,c=i.cy;"_hasHoverLabel"in n||(n._hasHoverLabel=!1),"_hasHoverEvent"in n||(n._hasHoverEvent=!1),t.on("mouseover",(function(t){var a=e._fullLayout,p=e._fullData[n.index];if(!e._dragging&&!1!==a.hovermode){var d=p.hoverinfo;if(Array.isArray(d)&&(d=r.castHoverinfo({hoverinfo:[u.castOption(d,t.pts)],_module:n._module},a,0)),"all"===d&&(d="label+text+value+percent+name"),p.hovertemplate||"none"!==d&&"skip"!==d&&d){var f=t.rInscribed||0,h=l+t.pxmid[0]*(1-f),v=c+t.pxmid[1]*(1-f),m=a.separators,y=[];if(d&&-1!==d.indexOf("label")&&y.push(t.label),t.text=u.castOption(p.hovertext||p.text,t.pts),d&&-1!==d.indexOf("text")){var g=t.text;s.isValidTextValue(g)&&y.push(g)}t.value=t.v,t.valueLabel=u.formatPieValue(t.v,m),d&&-1!==d.indexOf("value")&&y.push(t.valueLabel),t.percent=t.v/i.vTotal,t.percentLabel=u.formatPiePercent(t.percent,m),d&&-1!==d.indexOf("percent")&&y.push(t.percentLabel);var b=p.hoverlabel,T=b.font;r.loneHover({trace:n,x0:h-f*i.r,x1:h+f*i.r,y:v,text:y.join("<br>"),name:p.hovertemplate||-1!==d.indexOf("name")?p.name:void 0,idealAlign:t.pxmid[0]<0?"left":"right",color:u.castOption(b.bgcolor,t.pts)||t.color,borderColor:u.castOption(b.bordercolor,t.pts),fontFamily:u.castOption(T.family,t.pts),fontSize:u.castOption(T.size,t.pts),fontColor:u.castOption(T.color,t.pts),nameLength:u.castOption(b.namelength,t.pts),textAlign:u.castOption(b.align,t.pts),hovertemplate:u.castOption(p.hovertemplate,t.pts),hovertemplateLabels:t,eventData:[x(t,p)]},{container:a._hoverlayer.node(),outerContainer:a._paper.node(),gd:e}),n._hasHoverLabel=!0}n._hasHoverEvent=!0,e.emit("plotly_hover",{points:[x(t,p)],event:o.event})}})),t.on("mouseout",(function(t){var a=e._fullLayout,i=e._fullData[n.index],l=o.select(this).datum();n._hasHoverEvent&&(t.originalEvent=o.event,e.emit("plotly_unhover",{points:[x(l,i)],event:o.event}),n._hasHoverEvent=!1),n._hasHoverLabel&&(r.loneUnhover(a._hoverlayer.node()),n._hasHoverLabel=!1)})),t.on("click",(function(t){var a=e._fullLayout,i=e._fullData[n.index];e._dragging||!1===a.hovermode||(e._hoverdata=[x(t,i)],r.click(e,o.event))}))}function y(t,e,a){var o=u.castOption(t.insidetextfont.color,e.pts);!o&&t._input.textfont&&(o=u.castOption(t._input.textfont.color,e.pts));var i=u.castOption(t.insidetextfont.family,e.pts)||u.castOption(t.textfont.family,e.pts)||a.family,r=u.castOption(t.insidetextfont.size,e.pts)||u.castOption(t.textfont.size,e.pts)||a.size;return{color:o||n.contrast(e.color),family:i,size:r}}function g(t,e){for(var a,o,i=0;i<t.length;i++)if((o=(a=t[i][0]).trace).title.text){var r=o.title.text;o._meta&&(r=s.templateString(r,o._meta));var n=l.tester.append("text").attr("data-notex",1).text(r).call(l.font,o.title.font).call(c.convertToTspans,e),p=l.bBox(n.node(),!0);a.titleBox={width:p.width,height:p.height},n.remove()}}function b(t,e,a){var o=a.r||e.rpx1,i=e.rInscribed;if(e.startangle===e.stopangle)return{rCenter:1-i,scale:0,rotate:0,textPosAngle:0};var r,n=e.ring,l=1===n&&Math.abs(e.startangle-e.stopangle)===2*Math.PI,s=e.halfangle,c=e.midangle,p=a.trace.insidetextorientation,d="horizontal"===p,f="tangential"===p,h="radial"===p,u="auto"===p,x=[];if(!u){var v,m=function(a,i){if(function(t,e){var a=t.startangle,o=t.stopangle;return a>e&&e>o||a<e&&e<o}(e,a)){var l=Math.abs(a-e.startangle),s=Math.abs(a-e.stopangle),c=l<s?l:s;(r="tan"===i?M(t,o,n,c,0):T(t,o,n,c,Math.PI/2)).textPosAngle=a,x.push(r)}};if(d||f){for(v=4;v>=-4;v-=2)m(Math.PI*v,"tan");for(v=4;v>=-4;v-=2)m(Math.PI*(v+1),"tan")}if(d||h){for(v=4;v>=-4;v-=2)m(Math.PI*(v+1.5),"rad");for(v=4;v>=-4;v-=2)m(Math.PI*(v+.5),"rad")}}if(l||u||d){var y=Math.sqrt(t.width*t.width+t.height*t.height);if((r={scale:i*o*2/y,rCenter:1-i,rotate:0}).textPosAngle=(e.startangle+e.stopangle)/2,r.scale>=1)return r;x.push(r)}(u||h)&&((r=T(t,o,n,s,c)).textPosAngle=(e.startangle+e.stopangle)/2,x.push(r)),(u||f)&&((r=M(t,o,n,s,c)).textPosAngle=(e.startangle+e.stopangle)/2,x.push(r));for(var g=0,b=0,_=0;_<x.length;_++){var O=x[_].scale;if(b<O&&(b=O,g=_),!u&&b>=1)break}return x[g]}function T(t,e,a,o,i){e=Math.max(0,e-2*h);var r=t.width/t.height,n=w(r,o,e,a);return{scale:2*n/t.height,rCenter:_(r,n/e),rotate:O(i)}}function M(t,e,a,o,i){e=Math.max(0,e-2*h);var r=t.height/t.width,n=w(r,o,e,a);return{scale:2*n/t.width,rCenter:_(r,n/e),rotate:O(i+Math.PI/2)}}function _(t,e){return Math.cos(e)-t*e}function O(t){return(180/Math.PI*t+720)%180-90}function w(t,e,a,o){var i=t+1/(2*Math.tan(e));return a*Math.min(1/(Math.sqrt(i*i+.5)+i),o/(Math.sqrt(t*t+o/2)+t))}function L(t,e){return t.v!==e.vTotal||e.trace.hole?Math.min(1/(1+1/Math.sin(t.halfangle)),t.ring/2):1}function S(t,e){var a=e.pxmid[0],o=e.pxmid[1],i=t.width/2,r=t.height/2;return a<0&&(i*=-1),o<0&&(r*=-1),{scale:1,rCenter:1,rotate:0,x:i+Math.abs(r)*(i>0?1:-1)/2,y:r/(1+a*a/(o*o)),outside:!0}}function k(t,e){var a,o,i,r=t.trace,n={x:t.cx,y:t.cy},l={tx:0,ty:0};l.ty+=r.title.font.size,i=P(r),-1!==r.title.position.indexOf("top")?(n.y-=(1+i)*t.r,l.ty-=t.titleBox.height):-1!==r.title.position.indexOf("bottom")&&(n.y+=(1+i)*t.r);var s,c=t.r/(void 0===(s=t.trace.aspectratio)?1:s),p=e.w*(r.domain.x[1]-r.domain.x[0])/2;return-1!==r.title.position.indexOf("left")?(p+=c,n.x-=(1+i)*c,l.tx+=t.titleBox.width/2):-1!==r.title.position.indexOf("center")?p*=2:-1!==r.title.position.indexOf("right")&&(p+=c,n.x+=(1+i)*c,l.tx-=t.titleBox.width/2),a=p/t.titleBox.width,o=A(t,e)/t.titleBox.height,{x:n.x,y:n.y,scale:Math.min(a,o),tx:l.tx,ty:l.ty}}function A(t,e){var a=t.trace,o=e.h*(a.domain.y[1]-a.domain.y[0]);return Math.min(t.titleBox.height,o/2)}function P(t){var e,a=t.pull;if(!a)return 0;if(Array.isArray(a))for(a=0,e=0;e<t.pull.length;e++)t.pull[e]>a&&(a=t.pull[e]);return a}function E(t,e){for(var a=[],o=0;o<t.length;o++){var i=t[o][0],r=i.trace,n=r.domain,l=e.w*(n.x[1]-n.x[0]),s=e.h*(n.y[1]-n.y[0]);r.title.text&&"middle center"!==r.title.position&&(s-=A(i,e));var c=l/2,p=s/2;"funnelarea"!==r.type||r.scalegroup||(p/=r.aspectratio),i.r=Math.min(c,p)/(1+P(r)),i.cx=e.l+e.w*(r.domain.x[1]+r.domain.x[0])/2,i.cy=e.t+e.h*(1-r.domain.y[0])-s/2,r.title.text&&-1!==r.title.position.indexOf("bottom")&&(i.cy-=A(i,e)),r.scalegroup&&-1===a.indexOf(r.scalegroup)&&a.push(r.scalegroup)}!function(t,e){for(var a,o,i,r=0;r<e.length;r++){var n=1/0,l=e[r];for(o=0;o<t.length;o++)if((i=(a=t[o][0]).trace).scalegroup===l){var s;if("pie"===i.type)s=a.r*a.r;else if("funnelarea"===i.type){var c,p;i.aspectratio>1?p=(c=a.r)/i.aspectratio:c=(p=a.r)*i.aspectratio,s=(c*=(1+i.baseratio)/2)*p}n=Math.min(n,s/a.vTotal)}for(o=0;o<t.length;o++)if((i=(a=t[o][0]).trace).scalegroup===l){var d=n*a.vTotal;"funnelarea"===i.type&&(d/=(1+i.baseratio)/2,d/=i.aspectratio),a.r=Math.sqrt(d)}}}(t,a)}function j(t,e){return[t*Math.sin(e),-t*Math.cos(e)]}function I(t,e,a){var o=t._fullLayout,i=a.trace,r=i.texttemplate,n=i.textinfo;if(!r&&n&&"none"!==n){var l,c=n.split("+"),p=function(t){return-1!==c.indexOf(t)},d=p("label"),f=p("text"),h=p("value"),x=p("percent"),m=o.separators;if(l=d?[e.label]:[],f){var y=u.getFirstFilled(i.text,e.pts);v(y)&&l.push(y)}h&&l.push(u.formatPieValue(e.v,m)),x&&l.push(u.formatPiePercent(e.v/a.vTotal,m)),e.text=l.join("<br>")}if(r){var g=s.castOption(i,e.i,"texttemplate");if(g){var b=function(t){return{label:t.label,value:t.v,valueLabel:u.formatPieValue(t.v,o.separators),percent:t.v/a.vTotal,percentLabel:u.formatPiePercent(t.v/a.vTotal,o.separators),color:t.color,text:t.text,customdata:s.castOption(i,t.i,"customdata")}}(e),T=u.getFirstFilled(i.text,e.pts);(v(T)||""===T)&&(b.text=T),e.text=s.texttemplateString(g,b,t._fullLayout._d3locale,b,i._meta||{})}else e.text=""}}function z(t,e){var a=t.rotate*Math.PI/180,o=Math.cos(a),i=Math.sin(a),r=(e.left+e.right)/2,n=(e.top+e.bottom)/2;t.textX=r*o-n*i,t.textY=r*i+n*o,t.noCenter=!0}t.exports={plot:function(t,e){var a=t._fullLayout,r=a._size;f("pie",a),g(e,t),E(e,r);var p=s.makeTraceGroups(a._pielayer,e,"trace").each((function(e){var p=o.select(this),f=e[0],h=f.trace;!function(t){var e,a,o,i=t[0],r=i.r,n=i.trace,l=u.getRotationAngle(n.rotation),s=2*Math.PI/i.vTotal,c="px0",p="px1";if("counterclockwise"===n.direction){for(e=0;e<t.length&&t[e].hidden;e++);if(e===t.length)return;l+=s*t[e].v,s*=-1,c="px1",p="px0"}for(o=j(r,l),e=0;e<t.length;e++)(a=t[e]).hidden||(a[c]=o,a.startangle=l,l+=s*a.v/2,a.pxmid=j(r,l),a.midangle=l,o=j(r,l+=s*a.v/2),a.stopangle=l,a[p]=o,a.largeArc=a.v>i.vTotal/2?1:0,a.halfangle=Math.PI*Math.min(a.v/i.vTotal,.5),a.ring=1-n.hole,a.rInscribed=L(a,i))}(e),p.attr("stroke-linejoin","round"),p.each((function(){var x=o.select(this).selectAll("g.slice").data(e);x.enter().append("g").classed("slice",!0),x.exit().remove();var v=[[[],[]],[[],[]]],g=!1;x.each((function(i,r){if(i.hidden)o.select(this).selectAll("path,g").remove();else{i.pointNumber=i.i,i.curveNumber=h.index,v[i.pxmid[1]<0?0:1][i.pxmid[0]<0?0:1].push(i);var n=f.cx,p=f.cy,x=o.select(this),T=x.selectAll("path.surface").data([i]);if(T.enter().append("path").classed("surface",!0).style({"pointer-events":"all"}),x.call(m,t,e),h.pull){var M=+u.castOption(h.pull,i.pts)||0;M>0&&(n+=M*i.pxmid[0],p+=M*i.pxmid[1])}i.cxFinal=n,i.cyFinal=p;var _=h.hole;if(i.v===f.vTotal){var O="M"+(n+i.px0[0])+","+(p+i.px0[1])+P(i.px0,i.pxmid,!0,1)+P(i.pxmid,i.px0,!0,1)+"Z";_?T.attr("d","M"+(n+_*i.px0[0])+","+(p+_*i.px0[1])+P(i.px0,i.pxmid,!1,_)+P(i.pxmid,i.px0,!1,_)+"Z"+O):T.attr("d",O)}else{var w=P(i.px0,i.px1,!0,1);if(_){var L=1-_;T.attr("d","M"+(n+_*i.px1[0])+","+(p+_*i.px1[1])+P(i.px1,i.px0,!1,_)+"l"+L*i.px0[0]+","+L*i.px0[1]+w+"Z")}else T.attr("d","M"+n+","+p+"l"+i.px0[0]+","+i.px0[1]+w+"Z")}I(t,i,f);var k=u.castOption(h.textposition,i.pts),A=x.selectAll("g.slicetext").data(i.text&&"none"!==k?[0]:[]);A.enter().append("g").classed("slicetext",!0),A.exit().remove(),A.each((function(){var x=s.ensureSingle(o.select(this),"text","",(function(t){t.attr("data-notex",1)})),v=s.ensureUniformFontSize(t,"outside"===k?function(t,e,a){return{color:u.castOption(t.outsidetextfont.color,e.pts)||u.castOption(t.textfont.color,e.pts)||a.color,family:u.castOption(t.outsidetextfont.family,e.pts)||u.castOption(t.textfont.family,e.pts)||a.family,size:u.castOption(t.outsidetextfont.size,e.pts)||u.castOption(t.textfont.size,e.pts)||a.size}}(h,i,a.font):y(h,i,a.font));x.text(i.text).attr({class:"slicetext",transform:"","text-anchor":"middle"}).call(l.font,v).call(c.convertToTspans,t);var m,T=l.bBox(x.node());if("outside"===k)m=S(T,i);else if(m=b(T,i,f),"auto"===k&&m.scale<1){var M=s.ensureUniformFontSize(t,h.outsidetextfont);x.call(l.font,M),m=S(T=l.bBox(x.node()),i)}var _=m.textPosAngle,O=void 0===_?i.pxmid:j(f.r,_);if(m.targetX=n+O[0]*m.rCenter+(m.x||0),m.targetY=p+O[1]*m.rCenter+(m.y||0),z(m,T),m.outside){var w=m.targetY;i.yLabelMin=w-T.height/2,i.yLabelMid=w,i.yLabelMax=w+T.height/2,i.labelExtraX=0,i.labelExtraY=0,g=!0}m.fontSize=v.size,d(h.type,m,a),e[r].transform=m,x.attr("transform",s.getTextTransform(m))}))}function P(t,e,a,o){var r=o*(e[0]-t[0]),n=o*(e[1]-t[1]);return"a"+o*f.r+","+o*f.r+" 0 "+i.largeArc+(a?" 1 ":" 0 ")+r+","+n}}));var T=o.select(this).selectAll("g.titletext").data(h.title.text?[0]:[]);if(T.enter().append("g").classed("titletext",!0),T.exit().remove(),T.each((function(){var e,a=s.ensureSingle(o.select(this),"text","",(function(t){t.attr("data-notex",1)})),i=h.title.text;h._meta&&(i=s.templateString(i,h._meta)),a.text(i).attr({class:"titletext",transform:"","text-anchor":"middle"}).call(l.font,h.title.font).call(c.convertToTspans,t),e="middle center"===h.title.position?function(t){var e=Math.sqrt(t.titleBox.width*t.titleBox.width+t.titleBox.height*t.titleBox.height);return{x:t.cx,y:t.cy,scale:t.trace.hole*t.r*2/e,tx:0,ty:-t.titleBox.height/2+t.trace.title.font.size}}(f):k(f,r),a.attr("transform","translate("+e.x+","+e.y+")"+(e.scale<1?"scale("+e.scale+")":"")+"translate("+e.tx+","+e.ty+")")})),g&&function(t,e){var a,o,i,r,n,l,s,c,p,d,f,h,x;function v(t,e){return t.pxmid[1]-e.pxmid[1]}function m(t,e){return e.pxmid[1]-t.pxmid[1]}function y(t,a){a||(a={});var i,c,p,f,h=a.labelExtraY+(o?a.yLabelMax:a.yLabelMin),x=o?t.yLabelMin:t.yLabelMax,v=o?t.yLabelMax:t.yLabelMin,m=t.cyFinal+n(t.px0[1],t.px1[1]),y=h-x;if(y*s>0&&(t.labelExtraY=y),Array.isArray(e.pull))for(c=0;c<d.length;c++)(p=d[c])===t||(u.castOption(e.pull,t.pts)||0)>=(u.castOption(e.pull,p.pts)||0)||((t.pxmid[1]-p.pxmid[1])*s>0?(y=p.cyFinal+n(p.px0[1],p.px1[1])-x-t.labelExtraY)*s>0&&(t.labelExtraY+=y):(v+t.labelExtraY-m)*s>0&&(i=3*l*Math.abs(c-d.indexOf(t)),(f=p.cxFinal+r(p.px0[0],p.px1[0])+i-(t.cxFinal+t.pxmid[0])-t.labelExtraX)*l>0&&(t.labelExtraX+=f)))}for(o=0;o<2;o++)for(i=o?v:m,n=o?Math.max:Math.min,s=o?1:-1,a=0;a<2;a++){for(r=a?Math.max:Math.min,l=a?1:-1,(c=t[o][a]).sort(i),p=t[1-o][a],d=p.concat(c),h=[],f=0;f<c.length;f++)void 0!==c[f].yLabelMid&&h.push(c[f]);for(x=!1,f=0;o&&f<p.length;f++)if(void 0!==p[f].yLabelMid){x=p[f];break}for(f=0;f<h.length;f++){var g=f&&h[f-1];x&&!f&&(g=x),y(h[f],g)}}}(v,h),function(t,e){t.each((function(t){var a=o.select(this);if(t.labelExtraX||t.labelExtraY){var i=a.select("g.slicetext text");t.transform.targetX+=t.labelExtraX,t.transform.targetY+=t.labelExtraY,i.attr("transform",s.getTextTransform(t.transform));var r=t.cxFinal+t.pxmid[0],l="M"+r+","+(t.cyFinal+t.pxmid[1]),c=(t.yLabelMax-t.yLabelMin)*(t.pxmid[0]<0?-1:1)/4;if(t.labelExtraX){var p=t.labelExtraX*t.pxmid[1]/t.pxmid[0],d=t.yLabelMid+t.labelExtraY-(t.cyFinal+t.pxmid[1]);Math.abs(p)>Math.abs(d)?l+="l"+d*t.pxmid[0]/t.pxmid[1]+","+d+"H"+(r+t.labelExtraX+c):l+="l"+t.labelExtraX+","+p+"v"+(d-p)+"h"+c}else l+="V"+(t.yLabelMid+t.labelExtraY)+"h"+c;s.ensureSingle(a,"path","textline").call(n.stroke,e.outsidetextfont.color).attr({"stroke-width":Math.min(2,e.outsidetextfont.size/8),d:l,fill:"none"})}else a.select("path.textline").remove()}))}(x,h),g&&h.automargin){var M=l.bBox(p.node()),_=h.domain,O=r.w*(_.x[1]-_.x[0]),w=r.h*(_.y[1]-_.y[0]),L=(.5*O-f.r)/r.w,A=(.5*w-f.r)/r.h;i.autoMargin(t,"pie."+h.uid+".automargin",{xl:_.x[0]-L,xr:_.x[1]+L,yb:_.y[0]-A,yt:_.y[1]+A,l:Math.max(f.cx-f.r-M.left,0),r:Math.max(M.right-(f.cx+f.r),0),b:Math.max(M.bottom-(f.cy+f.r),0),t:Math.max(f.cy-f.r-M.top,0),pad:5})}}))}));setTimeout((function(){p.selectAll("tspan").each((function(){var t=o.select(this);t.attr("dy")&&t.attr("dy",t.attr("dy"))}))}),0)},formatSliceLabel:I,transformInsideText:b,determineInsideTextFont:y,positionTitleOutside:k,prerenderTitles:g,layoutAreas:E,attachFxHandlers:m,computeTransform:z}}}]);