(self.webpackChunkatoti_jupyterlab=self.webpackChunkatoti_jupyterlab||[]).push([[283],{40283:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var l=s(53521),n=s(39030),a=s(56271),o=s.n(a),r=s(58527),c=s.n(r),i=s(98537),u=s.n(i),m=s(2689),d=s.n(m),p=s(44652),b=s(13423);const h=e=>{const t=[];return e.forEach((e=>{const s=e.name;t.includes(s)||(e.showlegend=!0,t.push(s))})),e};function y({cube:e,data:t,metaData:s,widgetState:{colors:n,isTextVisible:a,mapping:o,opacity:r=1}}){if(!e||!t||!s)return[];const c={},i={},m={mapping:{},numberOfUsedAutomaticColors:0},{attributesRedirection:b}=s,y=o.size.length>0;let g=0;const x=o.horizontalSubplots.length+o.verticalSubplots.length>0;(0,p.IG)(t,s.hierarchyIndicesInCellSet,(({cell:e,cellIndex:t,columnIndex:d,members:p,rowIndex:h})=>{const y=(0,l.gU)(p,s.levelIndicesPerField,o,b),x=[...y.color,...y.horizontalSubplots,...y.verticalSubplots],I=y.splitBy,f=(0,l.Lj)(x),v=(0,l.Lj)(I),w=e.value,k=(({membersPerAttribute:e,pointKey:t,traceKey:o})=>(i[o]||(i[o]=function({traceKey:e,membersPerAttribute:t}){const o=(0,l.Ym)(t.color,0),c=Object.values(i).some((e=>e.name===o)),u=(0,l.he)({accumulator:m,colorway:s.colorway,colors:n,traceName:o});return{_key:e,hoverinfo:"none",legendgroup:o,mode:a?"text+markers":"markers",name:o,cellsIndices:[],showlegend:!c,text:[],textposition:"top center",type:"scatter",marker:{size:[],color:u},x:[],y:[],opacity:r}}({traceKey:o,membersPerAttribute:e})),u()(c,{[o]:{[t]:{}}}),c[o][t]))({membersPerAttribute:y,traceKey:f,pointKey:v});if(k.cellsIndices||(k.cellsIndices=[]),k.cellsIndices.push({rowIndex:h,columnIndex:d,cellIndex:t}),y.xValues.length>0)k.x=w;else if(y.yValues.length>0)k.y=w;else if(y.size.length>0){const e=Math.abs(w);k.size=e,e>g&&(g=e)}y.splitBy.length>0&&(k.text=(0,l.KT)(y.splitBy))})),Object.entries(i).forEach((([e,t])=>{const s=c[e];y||(t.marker.size=15),Object.values(s).forEach((e=>{const{cellsIndices:s,x:l,y:n,size:a,text:o}=e;t.cellsIndices.push(s),t.x.push(l),t.y.push(n),t.text.push(o),y&&t.marker.size.push(100*a/g)}))}));const I=Object.values(i);if(I.forEach((e=>{var t;e.axisIndices=d()(null===(t=e.x)||void 0===t?void 0:t.length)})),x){const e=s.subplots,t=(0,l.$)({traces:I,subplotsMetaData:e});return(0,l.Mr)(t,e),h(t),t}return h(I),I}const g=(0,l.i)((0,l.H9)((0,a.memo)((e=>{const{cube:t,data:s,metaData:r,widgetState:i,onLoaded:u}=e,m=(0,a.useMemo)((()=>(0,n.TS)(null==i?void 0:i.mapping)),[null==i?void 0:i.mapping]);(0,l.ge)({isEmpty:m,onLoaded:u});const d=(0,a.useMemo)((()=>y({cube:t,data:s,metaData:r,widgetState:i})),[t,s,r,i]),p=(0,a.useMemo)((()=>(e=>e?(0,b.IM)(l.bR,(0,l.S5)(e.subplots),(0,l.lH)(e.subplots)):{})(r)),[r]);return t&&s&&r&&!m?o().createElement(l.XN,c()({},e,{traces:d,layout:p,cube:t,data:s,metaData:r})):o().createElement(l.MQ,null)}))))}}]);